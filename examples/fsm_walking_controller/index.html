
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An open-source SDK for developing and testing algorithms on commonly used robotic hardware.">
      
      
        <meta name="author" content="Open-Source Leg">
      
      
        <link rel="canonical" href="https://neurobionics.github.io/opensourceleg/examples/fsm_walking_controller/">
      
      
        <link rel="prev" href="../basic_motion/">
      
      
        <link rel="next" href="../fsm_walking_ankle_controller/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Finite State Machine Walking Controller - opensourceleg</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#finite-state-machine-controller" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="opensourceleg" class="md-header__button md-logo" aria-label="opensourceleg" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            opensourceleg
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Finite State Machine Walking Controller
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/neurobionics/opensourceleg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    neurobionics/opensourceleg
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="opensourceleg" class="md-nav__button md-logo" aria-label="opensourceleg" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    opensourceleg
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/neurobionics/opensourceleg" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    neurobionics/opensourceleg
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sensors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Sensors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/sensors/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/sensors/reading_adc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading ADC Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/sensors/reading_encoder_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading Encoder Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/sensors/reading_imu_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading IMU Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/sensors/reading_loadcell_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading Loadcell Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Actuators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Actuators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/actuators/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/actuators/reading_sensor_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading Sensor Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/actuators/commanding_voltage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commanding Voltage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/actuators/commanding_current/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commanding Current
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/actuators/commanding_position/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commanding Position
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/actuators/commanding_impedance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commanding Impedance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/control/compiled_controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiled Controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/control/state_machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Machine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/control/torque_trajectory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Torque Trajectory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Logging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/logging/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/logging/configuring_logger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuring Logger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/logging/logging_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Robots
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Robots
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/robots/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/robots/homing_joints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Homing OSL Joints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_1" >
        
          
          <label class="md-nav__link" for="__nav_3_6_1" id="__nav_3_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SoftRealtimeLoop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6_1">
            <span class="md-nav__icon md-icon"></span>
            SoftRealtimeLoop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/utilities/softrealtimeloop/getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/utilities/softrealtimeloop/running_functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/utilities/softrealtimeloop/using_iterators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Iterators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/utilities/softrealtimeloop/realtime_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real-time Control
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/utilities/profiler/profiling_code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profiler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/other_best_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Other Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic_motion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Motion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Finite State Machine Walking Controller
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Finite State Machine Walking Controller
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Python Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Setup and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Main Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-code-for-the-python-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code for The Python Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-and-matlab-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      C++ and MATLAB Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C++ and MATLAB Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load-compiled-library" class="md-nav__link">
    <span class="md-ellipsis">
      Load Compiled Library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-custom-datatypes" class="md-nav__link">
    <span class="md-ellipsis">
      Define Custom Datatypes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-impedance-and-transition-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Impedance and Transition Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-loop_1" class="md-nav__link">
    <span class="md-ellipsis">
      Main Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-code-for-the-compiled-controller-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code for The Compiled Controller Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fsm_walking_ankle_controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FSM Walking Ankle Controller
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Actuators
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Actuators
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/actuators/actuators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/actuators/dephy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dephy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/actuators/moteus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Moteus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/actuators/tmotor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TMotor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Extras
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Extras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_1" >
        
          
          <label class="md-nav__link" for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Collections
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_1">
            <span class="md-nav__icon md-icon"></span>
            Collections
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/extras/collections/validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Safety
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            Safety
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/extras/safety/safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Safety
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/control/compiled/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiled Controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/control/fsm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Machine
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Logging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Math
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Math
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/math/math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Math
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sensors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Sensors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/sensors/sensors_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/sensors/imu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IMU
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/sensors/loadcell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Loadcell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/sensors/adc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/sensors/encoder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Encoder
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Robots
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Robots
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/robots/robots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/robots/osl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utilities/softrealtimeloop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SoftRealtimeLoop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utilities/profile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profiler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Python Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Setup and Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Main Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-code-for-the-python-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code for The Python Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-and-matlab-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      C++ and MATLAB Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C++ and MATLAB Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load-compiled-library" class="md-nav__link">
    <span class="md-ellipsis">
      Load Compiled Library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-custom-datatypes" class="md-nav__link">
    <span class="md-ellipsis">
      Define Custom Datatypes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-impedance-and-transition-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Impedance and Transition Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-loop_1" class="md-nav__link">
    <span class="md-ellipsis">
      Main Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-code-for-the-compiled-controller-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Full Code for The Compiled Controller Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="finite-state-machine-controller">Finite State Machine Controller<a class="headerlink" href="#finite-state-machine-controller" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The library ships with three example implementations of the same finite state machine (FSM) walking controller. The figure below shows the basic execution of the controller:</p>
<p><img alt="A diagram of the finite state machine" src="../assets/FSM_Diagram.svg" /></p>
<p>The first implementation is entirely in Python and uses the <code>StateMachine</code> class from the control subpackage of this library. If you plan to write your controllers exclusively in Python, this example is a good starting point.</p>
<p>The library also supports using compiled <code>C</code> and <code>C++</code> library functions via the <code>CompiledController</code> class. You can see a basic example of this module on the <a href="../../tutorials/control/compiled_controller/">tutorials page</a>, which may be helpful to review before starting with this example. We've duplicated the FSM behavior in both <code>C++</code> and <code>MATLAB</code>. The source code for these control implementations is available in <a href="https://github.com/neurobionics/OSL_CompiledControllers_Source">this repository</a>. Refer to the documentation in that repository for instructions on compiling both the <code>C++</code> and the <code>MATLAB</code> source code.</p>
<hr />
<h2 id="python-implementation">Python Implementation<a class="headerlink" href="#python-implementation" title="Permanent link">&para;</a></h2>
<h3 id="setup-and-configuration">Setup and Configuration<a class="headerlink" href="#setup-and-configuration" title="Permanent link">&para;</a></h3>
<p>First, we'll perform some standard imports:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.actuators.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONTROL_MODES</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.actuators.dephy</span><span class="w"> </span><span class="kn">import</span> <span class="n">DephyActuator</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.control.fsm</span><span class="w"> </span><span class="kn">import</span> <span class="n">State</span><span class="p">,</span> <span class="n">StateMachine</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.logging.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.robots.osl</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenSourceLeg</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.sensors.encoder</span><span class="w"> </span><span class="kn">import</span> <span class="n">AS5048B</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.sensors.loadcell</span><span class="w"> </span><span class="kn">import</span> <span class="n">NBLoadcellDAQ</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftRealtimeLoop</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">GEAR_RATIO</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="mi">83</span> <span class="o">/</span> <span class="mi">18</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">FREQUENCY</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">LOADCELL_CALIBRATION_MATRIX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">38.72600</span><span class="p">,</span> <span class="o">-</span><span class="mf">1817.74700</span><span class="p">,</span> <span class="mf">9.84900</span><span class="p">,</span> <span class="mf">43.37400</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.54000</span><span class="p">,</span> <span class="mf">1824.67000</span><span class="p">),</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">8.61600</span><span class="p">,</span> <span class="mf">1041.14900</span><span class="p">,</span> <span class="mf">18.86100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2098.82200</span><span class="p">,</span> <span class="mf">31.79400</span><span class="p">,</span> <span class="mf">1058.6230</span><span class="p">),</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">1047.16800</span><span class="p">,</span> <span class="mf">8.63900</span><span class="p">,</span> <span class="o">-</span><span class="mf">1047.28200</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.70000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1073.08800</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.92300</span><span class="p">),</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="p">(</span><span class="mf">20.57600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24600</span><span class="p">,</span> <span class="mf">0.55400</span><span class="p">,</span> <span class="o">-</span><span class="mf">21.40800</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.47600</span><span class="p">),</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">12.13400</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.10800</span><span class="p">,</span> <span class="mf">24.36100</span><span class="p">,</span> <span class="mf">0.02300</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.14100</span><span class="p">,</span> <span class="mf">0.79200</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">0.65100</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.28700</span><span class="p">,</span> <span class="mf">0.02200</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.23000</span><span class="p">,</span> <span class="mf">0.47300</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.3070</span><span class="p">),</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">])</span>
</span></code></pre></div>
<p>Next, we'll define all the tunable FSM parameters. These include the impedance parameters for each state as well as the transitions between states:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># ------------- TUNABLE FSM PARAMETERS ---------------- #</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">BODY_WEIGHT</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mf">9.8</span>  <span class="c1"># 30 * 9.8</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># STATE 1: EARLY STANCE</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">KNEE_K_ESTANCE</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">KNEE_B_ESTANCE</span> <span class="o">=</span> <span class="mf">3.180</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">KNEE_THETA_ESTANCE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">ANKLE_K_ESTANCE</span> <span class="o">=</span> <span class="mf">19.874</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">ANKLE_B_ESTANCE</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">ANKLE_THETA_ESTANCE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">LOAD_LSTANCE</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">BODY_WEIGHT</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="n">ANKLE_THETA_ESTANCE_TO_LSTANCE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="c1"># STATE 2: LATE STANCE</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="n">KNEE_K_LSTANCE</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="n">KNEE_B_LSTANCE</span> <span class="o">=</span> <span class="mf">1.272</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">KNEE_THETA_LSTANCE</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="n">ANKLE_K_LSTANCE</span> <span class="o">=</span> <span class="mf">79.498</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">ANKLE_B_LSTANCE</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="n">ANKLE_THETA_LSTANCE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="n">LOAD_ESWING</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">BODY_WEIGHT</span> <span class="o">*</span> <span class="mf">0.15</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="c1"># STATE 3: EARLY SWING</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="n">KNEE_K_ESWING</span> <span class="o">=</span> <span class="mf">39.749</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="n">KNEE_B_ESWING</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="n">KNEE_THETA_ESWING</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="n">ANKLE_K_ESWING</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="n">ANKLE_B_ESWING</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="n">ANKLE_THETA_ESWING</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="n">KNEE_THETA_ESWING_TO_LSWING</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="n">KNEE_DTHETA_ESWING_TO_LSWING</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="c1"># STATE 4: LATE SWING</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="n">KNEE_K_LSWING</span> <span class="o">=</span> <span class="mf">15.899</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="n">KNEE_B_LSWING</span> <span class="o">=</span> <span class="mf">3.816</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="n">KNEE_THETA_LSWING</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="n">ANKLE_K_LSWING</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="n">ANKLE_B_LSWING</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="n">ANKLE_THETA_LSWING</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="n">LOAD_ESTANCE</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">BODY_WEIGHT</span> <span class="o">*</span> <span class="mf">0.4</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="n">KNEE_THETA_LSWING_TO_ESTANCE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="c1"># ---------------------------------------------------- #</span>
</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>:
These parameters were roughly tuned for a moderately paced walking gait. You may want to tune them to better suit your intended use case.</p>
</blockquote>
<p>Next, we create a function that returns an instance of the <code>StateMachine</code> class. We start by making <code>State</code> objects for each of our four states and the include the impedance parameters in each. We also define transition criteria functions that determine when to move between states. We add the states and transition functions to an instance of the <code>StateMachine</code> class, specifiying that the initial state is <code>e_stance</code>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_simple_walking_fsm</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateMachine</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">e_stance</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e_stance&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_ESTANCE</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_ESTANCE</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_ESTANCE</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_ESTANCE</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_ESTANCE</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_ESTANCE</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">l_stance</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;l_stance&quot;</span><span class="p">,</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_LSTANCE</span><span class="p">,</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_LSTANCE</span><span class="p">,</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_LSTANCE</span><span class="p">,</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_LSTANCE</span><span class="p">,</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_LSTANCE</span><span class="p">,</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_LSTANCE</span><span class="p">,</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="p">)</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="n">e_swing</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e_swing&quot;</span><span class="p">,</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_ESWING</span><span class="p">,</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_ESWING</span><span class="p">,</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_ESWING</span><span class="p">,</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_ESWING</span><span class="p">,</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_ESWING</span><span class="p">,</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_ESWING</span><span class="p">,</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    <span class="p">)</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    <span class="n">l_swing</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;l_swing&quot;</span><span class="p">,</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_LSWING</span><span class="p">,</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_LSWING</span><span class="p">,</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_LSWING</span><span class="p">,</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_LSWING</span><span class="p">,</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_LSWING</span><span class="p">,</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_LSWING</span><span class="p">,</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>    <span class="p">)</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">estance_to_lstance</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="sd">        Transition from early stance to late stance when the loadcell</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="sd">        reads a force greater than a threshold.</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Loadcell is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span> <span class="o">&gt;</span> <span class="n">LOAD_LSTANCE</span> <span class="ow">and</span> <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">output_position</span> <span class="o">&gt;</span> <span class="n">ANKLE_THETA_ESTANCE_TO_LSTANCE</span><span class="p">)</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lstance_to_eswing</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="sd">        Transition from late stance to early swing when the loadcell</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="sd">        reads a force less than a threshold.</span>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Loadcell is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span> <span class="o">&lt;</span> <span class="n">LOAD_ESWING</span><span class="p">)</span>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eswing_to_lswing</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="sd">        Transition from early swing to late swing when the knee angle</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="sd">        is greater than a threshold and the knee velocity is less than</span>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a><span class="sd">        a threshold.</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Knee is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-2-68"><a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
</span><span id="__span-2-69"><a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a>            <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span> <span class="o">&gt;</span> <span class="n">KNEE_THETA_ESWING_TO_LSWING</span>
</span><span id="__span-2-70"><a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a>            <span class="ow">and</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_velocity</span> <span class="o">&lt;</span> <span class="n">KNEE_DTHETA_ESWING_TO_LSWING</span>
</span><span id="__span-2-71"><a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a>        <span class="p">)</span>
</span><span id="__span-2-72"><a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a>
</span><span id="__span-2-73"><a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lswing_to_estance</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-74"><a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-75"><a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a><span class="sd">        Transition from late swing to early stance when the loadcell</span>
</span><span id="__span-2-76"><a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a><span class="sd">        reads a force greater than a threshold or the knee angle is</span>
</span><span id="__span-2-77"><a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a><span class="sd">        less than a threshold.</span>
</span><span id="__span-2-78"><a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-2-79"><a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-80"><a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Knee is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-2-81"><a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-82"><a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Loadcell is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-2-83"><a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span> <span class="o">&gt;</span> <span class="n">LOAD_ESTANCE</span> <span class="ow">or</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span> <span class="o">&lt;</span> <span class="n">KNEE_THETA_LSWING_TO_ESTANCE</span><span class="p">)</span>
</span><span id="__span-2-84"><a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a>
</span><span id="__span-2-85"><a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a>    <span class="n">fsm</span> <span class="o">=</span> <span class="n">StateMachine</span><span class="p">(</span>
</span><span id="__span-2-86"><a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a>        <span class="n">states</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-2-87"><a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a>            <span class="n">e_stance</span><span class="p">,</span>
</span><span id="__span-2-88"><a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a>            <span class="n">l_stance</span><span class="p">,</span>
</span><span id="__span-2-89"><a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a>            <span class="n">e_swing</span><span class="p">,</span>
</span><span id="__span-2-90"><a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a>            <span class="n">l_swing</span><span class="p">,</span>
</span><span id="__span-2-91"><a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a>        <span class="p">],</span>
</span><span id="__span-2-92"><a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a>        <span class="n">initial_state_name</span><span class="o">=</span><span class="s2">&quot;e_stance&quot;</span><span class="p">,</span>
</span><span id="__span-2-93"><a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a>    <span class="p">)</span>
</span><span id="__span-2-94"><a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a>
</span><span id="__span-2-95"><a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-2-96"><a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a>        <span class="n">source</span><span class="o">=</span><span class="n">e_stance</span><span class="p">,</span>
</span><span id="__span-2-97"><a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">l_stance</span><span class="p">,</span>
</span><span id="__span-2-98"><a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;foot_flat&quot;</span><span class="p">,</span>
</span><span id="__span-2-99"><a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">estance_to_lstance</span><span class="p">,</span>
</span><span id="__span-2-100"><a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a>    <span class="p">)</span>
</span><span id="__span-2-101"><a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-2-102"><a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a>        <span class="n">source</span><span class="o">=</span><span class="n">l_stance</span><span class="p">,</span>
</span><span id="__span-2-103"><a id="__codelineno-2-103" name="__codelineno-2-103" href="#__codelineno-2-103"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">e_swing</span><span class="p">,</span>
</span><span id="__span-2-104"><a id="__codelineno-2-104" name="__codelineno-2-104" href="#__codelineno-2-104"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;heel_off&quot;</span><span class="p">,</span>
</span><span id="__span-2-105"><a id="__codelineno-2-105" name="__codelineno-2-105" href="#__codelineno-2-105"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">lstance_to_eswing</span><span class="p">,</span>
</span><span id="__span-2-106"><a id="__codelineno-2-106" name="__codelineno-2-106" href="#__codelineno-2-106"></a>    <span class="p">)</span>
</span><span id="__span-2-107"><a id="__codelineno-2-107" name="__codelineno-2-107" href="#__codelineno-2-107"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-2-108"><a id="__codelineno-2-108" name="__codelineno-2-108" href="#__codelineno-2-108"></a>        <span class="n">source</span><span class="o">=</span><span class="n">e_swing</span><span class="p">,</span>
</span><span id="__span-2-109"><a id="__codelineno-2-109" name="__codelineno-2-109" href="#__codelineno-2-109"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">l_swing</span><span class="p">,</span>
</span><span id="__span-2-110"><a id="__codelineno-2-110" name="__codelineno-2-110" href="#__codelineno-2-110"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;toe_off&quot;</span><span class="p">,</span>
</span><span id="__span-2-111"><a id="__codelineno-2-111" name="__codelineno-2-111" href="#__codelineno-2-111"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">eswing_to_lswing</span><span class="p">,</span>
</span><span id="__span-2-112"><a id="__codelineno-2-112" name="__codelineno-2-112" href="#__codelineno-2-112"></a>    <span class="p">)</span>
</span><span id="__span-2-113"><a id="__codelineno-2-113" name="__codelineno-2-113" href="#__codelineno-2-113"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-2-114"><a id="__codelineno-2-114" name="__codelineno-2-114" href="#__codelineno-2-114"></a>        <span class="n">source</span><span class="o">=</span><span class="n">l_swing</span><span class="p">,</span>
</span><span id="__span-2-115"><a id="__codelineno-2-115" name="__codelineno-2-115" href="#__codelineno-2-115"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">e_stance</span><span class="p">,</span>
</span><span id="__span-2-116"><a id="__codelineno-2-116" name="__codelineno-2-116" href="#__codelineno-2-116"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;heel_strike&quot;</span><span class="p">,</span>
</span><span id="__span-2-117"><a id="__codelineno-2-117" name="__codelineno-2-117" href="#__codelineno-2-117"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">lswing_to_estance</span><span class="p">,</span>
</span><span id="__span-2-118"><a id="__codelineno-2-118" name="__codelineno-2-118" href="#__codelineno-2-118"></a>    <span class="p">)</span>
</span><span id="__span-2-119"><a id="__codelineno-2-119" name="__codelineno-2-119" href="#__codelineno-2-119"></a>    <span class="k">return</span> <span class="n">fsm</span>
</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>:
If instantiating the OSL hardware and sensors is unfamiliar, check out the <a href="../../tutorials/actuators/getting_started/">the tutorials pages</a>.</p>
</blockquote>
<p>Next, we initialize the standard actuators, sensors, logger, and loop classes for the OSL:
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">actuators</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        <span class="s2">&quot;knee&quot;</span><span class="p">:</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;knee&quot;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>            <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM0&quot;</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>            <span class="n">gear_ratio</span><span class="o">=</span><span class="n">GEAR_RATIO</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>            <span class="n">debug_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>            <span class="n">dephy_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="p">),</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="s2">&quot;ankle&quot;</span><span class="p">:</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;ankle&quot;</span><span class="p">,</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>            <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM1&quot;</span><span class="p">,</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>            <span class="n">gear_ratio</span><span class="o">=</span><span class="n">GEAR_RATIO</span><span class="p">,</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>            <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>            <span class="n">debug_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>            <span class="n">dephy_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>        <span class="p">),</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="p">}</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    <span class="n">sensors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="c1"># &quot;loadcell&quot;: DephyLoadcellAmplifier(</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        <span class="c1">#     calibration_matrix=LOADCELL_CALIBRATION_MATRIX,</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>        <span class="c1"># ),</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>        <span class="s2">&quot;loadcell&quot;</span><span class="p">:</span> <span class="n">NBLoadcellDAQ</span><span class="p">(</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>            <span class="n">LOADCELL_CALIBRATION_MATRIX</span><span class="p">,</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;loadcell&quot;</span><span class="p">,</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>            <span class="n">excitation_voltage</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>            <span class="n">amp_gain</span><span class="o">=</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">151</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>            <span class="n">spi_bus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="p">),</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="s2">&quot;joint_encoder_knee&quot;</span><span class="p">:</span> <span class="n">AS5048B</span><span class="p">(</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;joint_encoder_knee&quot;</span><span class="p">,</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>            <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;/dev/i2c-2&quot;</span><span class="p">,</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>            <span class="n">A1_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>            <span class="n">A2_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>            <span class="n">zero_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>            <span class="n">enable_diagnostics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>        <span class="p">),</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>        <span class="s2">&quot;joint_encoder_ankle&quot;</span><span class="p">:</span> <span class="n">AS5048B</span><span class="p">(</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;joint_encoder_ankle&quot;</span><span class="p">,</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>            <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;/dev/i2c-3&quot;</span><span class="p">,</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>            <span class="n">A1_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>            <span class="n">A2_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>            <span class="n">zero_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>            <span class="n">enable_diagnostics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>        <span class="p">),</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>    <span class="p">}</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>    <span class="n">clock</span> <span class="o">=</span> <span class="n">SoftRealtimeLoop</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">FREQUENCY</span><span class="p">)</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>    <span class="n">fsm_logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>        <span class="n">log_path</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>        <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;fsm.log&quot;</span><span class="p">,</span>
</span></code></pre></div></p>
<p>We then call the FSM definition function we made above and initialize/home the hardware:
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>    <span class="n">osl</span> <span class="o">=</span> <span class="n">OpenSourceLeg</span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;osl&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="n">actuators</span><span class="o">=</span><span class="n">actuators</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>        <span class="n">sensors</span><span class="o">=</span><span class="n">sensors</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="p">)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="n">osl_fsm</span> <span class="o">=</span> <span class="n">create_simple_walking_fsm</span><span class="p">(</span><span class="n">osl</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="c1"># Zeroing the joint encoders</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">knee_homing_complete</span><span class="p">():</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_knee</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_knee</span><span class="o">.</span><span class="n">zero_position</span> <span class="o">=</span> <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_knee</span><span class="o">.</span><span class="n">counts</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Knee homing complete!&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
<h3 id="main-loop">Main Loop<a class="headerlink" href="#main-loop" title="Permanent link">&para;</a></h3>
<p>Now that everything is set up, we enter the main loop. During each iteration of the main loop, we call the update method for both the OSL and the FSM. We then write the current impedance parameters for each joint to the hardware. A print statement and logging are also included for debugging:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>        <span class="c1"># The hard stop for ankle is at 30 deg from the zero position</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">zero_position</span> <span class="o">=</span> <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">counts</span> <span class="o">-</span> <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">deg_to_counts</span><span class="p">(</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>            <span class="mi">30</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="p">)</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ankle homing complete!&quot;</span><span class="p">)</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;knee&quot;</span><span class="p">:</span> <span class="n">knee_homing_complete</span><span class="p">,</span> <span class="s2">&quot;ankle&quot;</span><span class="p">:</span> <span class="n">ankle_homing_complete</span><span class="p">}</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="k">with</span> <span class="n">osl</span><span class="p">,</span> <span class="n">osl_fsm</span><span class="p">:</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to start walking...&quot;</span><span class="p">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>        <span class="c1"># knee</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">()</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>        <span class="c1"># ankle</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">()</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="full-code-for-the-python-implementation">Full Code for The Python Implementation<a class="headerlink" href="#full-code-for-the-python-implementation" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.actuators.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONTROL_MODES</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.actuators.dephy</span><span class="w"> </span><span class="kn">import</span> <span class="n">DephyActuator</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.control.fsm</span><span class="w"> </span><span class="kn">import</span> <span class="n">State</span><span class="p">,</span> <span class="n">StateMachine</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.logging.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.robots.osl</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenSourceLeg</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.sensors.encoder</span><span class="w"> </span><span class="kn">import</span> <span class="n">AS5048B</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.sensors.loadcell</span><span class="w"> </span><span class="kn">import</span> <span class="n">NBLoadcellDAQ</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftRealtimeLoop</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">GEAR_RATIO</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="mi">83</span> <span class="o">/</span> <span class="mi">18</span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="n">FREQUENCY</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="n">LOADCELL_CALIBRATION_MATRIX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">38.72600</span><span class="p">,</span> <span class="o">-</span><span class="mf">1817.74700</span><span class="p">,</span> <span class="mf">9.84900</span><span class="p">,</span> <span class="mf">43.37400</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.54000</span><span class="p">,</span> <span class="mf">1824.67000</span><span class="p">),</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">8.61600</span><span class="p">,</span> <span class="mf">1041.14900</span><span class="p">,</span> <span class="mf">18.86100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2098.82200</span><span class="p">,</span> <span class="mf">31.79400</span><span class="p">,</span> <span class="mf">1058.6230</span><span class="p">),</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">1047.16800</span><span class="p">,</span> <span class="mf">8.63900</span><span class="p">,</span> <span class="o">-</span><span class="mf">1047.28200</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.70000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1073.08800</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.92300</span><span class="p">),</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    <span class="p">(</span><span class="mf">20.57600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24600</span><span class="p">,</span> <span class="mf">0.55400</span><span class="p">,</span> <span class="o">-</span><span class="mf">21.40800</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.47600</span><span class="p">),</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">12.13400</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.10800</span><span class="p">,</span> <span class="mf">24.36100</span><span class="p">,</span> <span class="mf">0.02300</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.14100</span><span class="p">,</span> <span class="mf">0.79200</span><span class="p">),</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">0.65100</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.28700</span><span class="p">,</span> <span class="mf">0.02200</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.23000</span><span class="p">,</span> <span class="mf">0.47300</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.3070</span><span class="p">),</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="p">])</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="c1"># ------------- TUNABLE FSM PARAMETERS ---------------- #</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="n">BODY_WEIGHT</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mf">9.8</span>  <span class="c1"># 30 * 9.8</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="c1"># STATE 1: EARLY STANCE</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="n">KNEE_K_ESTANCE</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="n">KNEE_B_ESTANCE</span> <span class="o">=</span> <span class="mf">3.180</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="n">KNEE_THETA_ESTANCE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="n">ANKLE_K_ESTANCE</span> <span class="o">=</span> <span class="mf">19.874</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="n">ANKLE_B_ESTANCE</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="n">ANKLE_THETA_ESTANCE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="n">LOAD_LSTANCE</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">BODY_WEIGHT</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="n">ANKLE_THETA_ESTANCE_TO_LSTANCE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">6.0</span><span class="p">)</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="c1"># STATE 2: LATE STANCE</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="n">KNEE_K_LSTANCE</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="n">KNEE_B_LSTANCE</span> <span class="o">=</span> <span class="mf">1.272</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="n">KNEE_THETA_LSTANCE</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="n">ANKLE_K_LSTANCE</span> <span class="o">=</span> <span class="mf">79.498</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="n">ANKLE_B_LSTANCE</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="n">ANKLE_THETA_LSTANCE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="n">LOAD_ESWING</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">BODY_WEIGHT</span> <span class="o">*</span> <span class="mf">0.15</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="c1"># STATE 3: EARLY SWING</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="n">KNEE_K_ESWING</span> <span class="o">=</span> <span class="mf">39.749</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="n">KNEE_B_ESWING</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="n">KNEE_THETA_ESWING</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="n">ANKLE_K_ESWING</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="n">ANKLE_B_ESWING</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="n">ANKLE_THETA_ESWING</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="n">KNEE_THETA_ESWING_TO_LSWING</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="n">KNEE_DTHETA_ESWING_TO_LSWING</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="c1"># STATE 4: LATE SWING</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="n">KNEE_K_LSWING</span> <span class="o">=</span> <span class="mf">15.899</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="n">KNEE_B_LSWING</span> <span class="o">=</span> <span class="mf">3.816</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="n">KNEE_THETA_LSWING</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="n">ANKLE_K_LSWING</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="n">ANKLE_B_LSWING</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="n">ANKLE_THETA_LSWING</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="n">LOAD_ESTANCE</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">BODY_WEIGHT</span> <span class="o">*</span> <span class="mf">0.4</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="n">KNEE_THETA_LSWING_TO_ESTANCE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="c1"># ---------------------------------------------------- #</span>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_simple_walking_fsm</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StateMachine</span><span class="p">:</span>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>    <span class="n">e_stance</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e_stance&quot;</span><span class="p">,</span>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_ESTANCE</span><span class="p">,</span>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_ESTANCE</span><span class="p">,</span>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_ESTANCE</span><span class="p">,</span>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_ESTANCE</span><span class="p">,</span>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_ESTANCE</span><span class="p">,</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_ESTANCE</span><span class="p">,</span>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>    <span class="p">)</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>    <span class="n">l_stance</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;l_stance&quot;</span><span class="p">,</span>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_LSTANCE</span><span class="p">,</span>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_LSTANCE</span><span class="p">,</span>
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_LSTANCE</span><span class="p">,</span>
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_LSTANCE</span><span class="p">,</span>
</span><span id="__span-6-85"><a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_LSTANCE</span><span class="p">,</span>
</span><span id="__span-6-86"><a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_LSTANCE</span><span class="p">,</span>
</span><span id="__span-6-87"><a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>    <span class="p">)</span>
</span><span id="__span-6-88"><a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>
</span><span id="__span-6-89"><a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>    <span class="n">e_swing</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-6-90"><a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;e_swing&quot;</span><span class="p">,</span>
</span><span id="__span-6-91"><a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_ESWING</span><span class="p">,</span>
</span><span id="__span-6-92"><a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_ESWING</span><span class="p">,</span>
</span><span id="__span-6-93"><a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_ESWING</span><span class="p">,</span>
</span><span id="__span-6-94"><a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_ESWING</span><span class="p">,</span>
</span><span id="__span-6-95"><a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_ESWING</span><span class="p">,</span>
</span><span id="__span-6-96"><a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_ESWING</span><span class="p">,</span>
</span><span id="__span-6-97"><a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>    <span class="p">)</span>
</span><span id="__span-6-98"><a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>
</span><span id="__span-6-99"><a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>    <span class="n">l_swing</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span>
</span><span id="__span-6-100"><a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;l_swing&quot;</span><span class="p">,</span>
</span><span id="__span-6-101"><a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>        <span class="n">knee_theta</span><span class="o">=</span><span class="n">KNEE_THETA_LSWING</span><span class="p">,</span>
</span><span id="__span-6-102"><a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>        <span class="n">knee_stiffness</span><span class="o">=</span><span class="n">KNEE_K_LSWING</span><span class="p">,</span>
</span><span id="__span-6-103"><a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>        <span class="n">knee_damping</span><span class="o">=</span><span class="n">KNEE_B_LSWING</span><span class="p">,</span>
</span><span id="__span-6-104"><a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a>        <span class="n">ankle_theta</span><span class="o">=</span><span class="n">ANKLE_THETA_LSWING</span><span class="p">,</span>
</span><span id="__span-6-105"><a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>        <span class="n">ankle_stiffness</span><span class="o">=</span><span class="n">ANKLE_K_LSWING</span><span class="p">,</span>
</span><span id="__span-6-106"><a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a>        <span class="n">ankle_damping</span><span class="o">=</span><span class="n">ANKLE_B_LSWING</span><span class="p">,</span>
</span><span id="__span-6-107"><a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>    <span class="p">)</span>
</span><span id="__span-6-108"><a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>
</span><span id="__span-6-109"><a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">estance_to_lstance</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-6-110"><a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-111"><a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a><span class="sd">        Transition from early stance to late stance when the loadcell</span>
</span><span id="__span-6-112"><a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a><span class="sd">        reads a force greater than a threshold.</span>
</span><span id="__span-6-113"><a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-6-114"><a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-115"><a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Loadcell is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-6-116"><a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span> <span class="o">&gt;</span> <span class="n">LOAD_LSTANCE</span> <span class="ow">and</span> <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">output_position</span> <span class="o">&gt;</span> <span class="n">ANKLE_THETA_ESTANCE_TO_LSTANCE</span><span class="p">)</span>
</span><span id="__span-6-117"><a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a>
</span><span id="__span-6-118"><a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lstance_to_eswing</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-6-119"><a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-120"><a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a><span class="sd">        Transition from late stance to early swing when the loadcell</span>
</span><span id="__span-6-121"><a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a><span class="sd">        reads a force less than a threshold.</span>
</span><span id="__span-6-122"><a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-6-123"><a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-124"><a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Loadcell is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-6-125"><a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span> <span class="o">&lt;</span> <span class="n">LOAD_ESWING</span><span class="p">)</span>
</span><span id="__span-6-126"><a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a>
</span><span id="__span-6-127"><a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">eswing_to_lswing</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-6-128"><a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-129"><a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a><span class="sd">        Transition from early swing to late swing when the knee angle</span>
</span><span id="__span-6-130"><a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a><span class="sd">        is greater than a threshold and the knee velocity is less than</span>
</span><span id="__span-6-131"><a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a><span class="sd">        a threshold.</span>
</span><span id="__span-6-132"><a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-6-133"><a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-134"><a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Knee is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-6-135"><a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span>
</span><span id="__span-6-136"><a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a>            <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span> <span class="o">&gt;</span> <span class="n">KNEE_THETA_ESWING_TO_LSWING</span>
</span><span id="__span-6-137"><a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a>            <span class="ow">and</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_velocity</span> <span class="o">&lt;</span> <span class="n">KNEE_DTHETA_ESWING_TO_LSWING</span>
</span><span id="__span-6-138"><a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a>        <span class="p">)</span>
</span><span id="__span-6-139"><a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a>
</span><span id="__span-6-140"><a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lswing_to_estance</span><span class="p">(</span><span class="n">osl</span><span class="p">:</span> <span class="n">OpenSourceLeg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-6-141"><a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-142"><a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a><span class="sd">        Transition from late swing to early stance when the loadcell</span>
</span><span id="__span-6-143"><a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a><span class="sd">        reads a force greater than a threshold or the knee angle is</span>
</span><span id="__span-6-144"><a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a><span class="sd">        less than a threshold.</span>
</span><span id="__span-6-145"><a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-6-146"><a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-147"><a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Knee is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-6-148"><a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>        <span class="k">if</span> <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-149"><a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Loadcell is not connected&quot;</span><span class="p">)</span>
</span><span id="__span-6-150"><a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a>        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span> <span class="o">&gt;</span> <span class="n">LOAD_ESTANCE</span> <span class="ow">or</span> <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span> <span class="o">&lt;</span> <span class="n">KNEE_THETA_LSWING_TO_ESTANCE</span><span class="p">)</span>
</span><span id="__span-6-151"><a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a>
</span><span id="__span-6-152"><a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a>    <span class="n">fsm</span> <span class="o">=</span> <span class="n">StateMachine</span><span class="p">(</span>
</span><span id="__span-6-153"><a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a>        <span class="n">states</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-6-154"><a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a>            <span class="n">e_stance</span><span class="p">,</span>
</span><span id="__span-6-155"><a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a>            <span class="n">l_stance</span><span class="p">,</span>
</span><span id="__span-6-156"><a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a>            <span class="n">e_swing</span><span class="p">,</span>
</span><span id="__span-6-157"><a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a>            <span class="n">l_swing</span><span class="p">,</span>
</span><span id="__span-6-158"><a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a>        <span class="p">],</span>
</span><span id="__span-6-159"><a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a>        <span class="n">initial_state_name</span><span class="o">=</span><span class="s2">&quot;e_stance&quot;</span><span class="p">,</span>
</span><span id="__span-6-160"><a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a>    <span class="p">)</span>
</span><span id="__span-6-161"><a id="__codelineno-6-161" name="__codelineno-6-161" href="#__codelineno-6-161"></a>
</span><span id="__span-6-162"><a id="__codelineno-6-162" name="__codelineno-6-162" href="#__codelineno-6-162"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-6-163"><a id="__codelineno-6-163" name="__codelineno-6-163" href="#__codelineno-6-163"></a>        <span class="n">source</span><span class="o">=</span><span class="n">e_stance</span><span class="p">,</span>
</span><span id="__span-6-164"><a id="__codelineno-6-164" name="__codelineno-6-164" href="#__codelineno-6-164"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">l_stance</span><span class="p">,</span>
</span><span id="__span-6-165"><a id="__codelineno-6-165" name="__codelineno-6-165" href="#__codelineno-6-165"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;foot_flat&quot;</span><span class="p">,</span>
</span><span id="__span-6-166"><a id="__codelineno-6-166" name="__codelineno-6-166" href="#__codelineno-6-166"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">estance_to_lstance</span><span class="p">,</span>
</span><span id="__span-6-167"><a id="__codelineno-6-167" name="__codelineno-6-167" href="#__codelineno-6-167"></a>    <span class="p">)</span>
</span><span id="__span-6-168"><a id="__codelineno-6-168" name="__codelineno-6-168" href="#__codelineno-6-168"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-6-169"><a id="__codelineno-6-169" name="__codelineno-6-169" href="#__codelineno-6-169"></a>        <span class="n">source</span><span class="o">=</span><span class="n">l_stance</span><span class="p">,</span>
</span><span id="__span-6-170"><a id="__codelineno-6-170" name="__codelineno-6-170" href="#__codelineno-6-170"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">e_swing</span><span class="p">,</span>
</span><span id="__span-6-171"><a id="__codelineno-6-171" name="__codelineno-6-171" href="#__codelineno-6-171"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;heel_off&quot;</span><span class="p">,</span>
</span><span id="__span-6-172"><a id="__codelineno-6-172" name="__codelineno-6-172" href="#__codelineno-6-172"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">lstance_to_eswing</span><span class="p">,</span>
</span><span id="__span-6-173"><a id="__codelineno-6-173" name="__codelineno-6-173" href="#__codelineno-6-173"></a>    <span class="p">)</span>
</span><span id="__span-6-174"><a id="__codelineno-6-174" name="__codelineno-6-174" href="#__codelineno-6-174"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-6-175"><a id="__codelineno-6-175" name="__codelineno-6-175" href="#__codelineno-6-175"></a>        <span class="n">source</span><span class="o">=</span><span class="n">e_swing</span><span class="p">,</span>
</span><span id="__span-6-176"><a id="__codelineno-6-176" name="__codelineno-6-176" href="#__codelineno-6-176"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">l_swing</span><span class="p">,</span>
</span><span id="__span-6-177"><a id="__codelineno-6-177" name="__codelineno-6-177" href="#__codelineno-6-177"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;toe_off&quot;</span><span class="p">,</span>
</span><span id="__span-6-178"><a id="__codelineno-6-178" name="__codelineno-6-178" href="#__codelineno-6-178"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">eswing_to_lswing</span><span class="p">,</span>
</span><span id="__span-6-179"><a id="__codelineno-6-179" name="__codelineno-6-179" href="#__codelineno-6-179"></a>    <span class="p">)</span>
</span><span id="__span-6-180"><a id="__codelineno-6-180" name="__codelineno-6-180" href="#__codelineno-6-180"></a>    <span class="n">fsm</span><span class="o">.</span><span class="n">add_transition</span><span class="p">(</span>
</span><span id="__span-6-181"><a id="__codelineno-6-181" name="__codelineno-6-181" href="#__codelineno-6-181"></a>        <span class="n">source</span><span class="o">=</span><span class="n">l_swing</span><span class="p">,</span>
</span><span id="__span-6-182"><a id="__codelineno-6-182" name="__codelineno-6-182" href="#__codelineno-6-182"></a>        <span class="n">destination</span><span class="o">=</span><span class="n">e_stance</span><span class="p">,</span>
</span><span id="__span-6-183"><a id="__codelineno-6-183" name="__codelineno-6-183" href="#__codelineno-6-183"></a>        <span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;heel_strike&quot;</span><span class="p">,</span>
</span><span id="__span-6-184"><a id="__codelineno-6-184" name="__codelineno-6-184" href="#__codelineno-6-184"></a>        <span class="n">criteria</span><span class="o">=</span><span class="n">lswing_to_estance</span><span class="p">,</span>
</span><span id="__span-6-185"><a id="__codelineno-6-185" name="__codelineno-6-185" href="#__codelineno-6-185"></a>    <span class="p">)</span>
</span><span id="__span-6-186"><a id="__codelineno-6-186" name="__codelineno-6-186" href="#__codelineno-6-186"></a>    <span class="k">return</span> <span class="n">fsm</span>
</span><span id="__span-6-187"><a id="__codelineno-6-187" name="__codelineno-6-187" href="#__codelineno-6-187"></a>
</span><span id="__span-6-188"><a id="__codelineno-6-188" name="__codelineno-6-188" href="#__codelineno-6-188"></a>
</span><span id="__span-6-189"><a id="__codelineno-6-189" name="__codelineno-6-189" href="#__codelineno-6-189"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-6-190"><a id="__codelineno-6-190" name="__codelineno-6-190" href="#__codelineno-6-190"></a>    <span class="n">actuators</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-191"><a id="__codelineno-6-191" name="__codelineno-6-191" href="#__codelineno-6-191"></a>        <span class="s2">&quot;knee&quot;</span><span class="p">:</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-6-192"><a id="__codelineno-6-192" name="__codelineno-6-192" href="#__codelineno-6-192"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;knee&quot;</span><span class="p">,</span>
</span><span id="__span-6-193"><a id="__codelineno-6-193" name="__codelineno-6-193" href="#__codelineno-6-193"></a>            <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM0&quot;</span><span class="p">,</span>
</span><span id="__span-6-194"><a id="__codelineno-6-194" name="__codelineno-6-194" href="#__codelineno-6-194"></a>            <span class="n">gear_ratio</span><span class="o">=</span><span class="n">GEAR_RATIO</span><span class="p">,</span>
</span><span id="__span-6-195"><a id="__codelineno-6-195" name="__codelineno-6-195" href="#__codelineno-6-195"></a>            <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-6-196"><a id="__codelineno-6-196" name="__codelineno-6-196" href="#__codelineno-6-196"></a>            <span class="n">debug_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-6-197"><a id="__codelineno-6-197" name="__codelineno-6-197" href="#__codelineno-6-197"></a>            <span class="n">dephy_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-198"><a id="__codelineno-6-198" name="__codelineno-6-198" href="#__codelineno-6-198"></a>        <span class="p">),</span>
</span><span id="__span-6-199"><a id="__codelineno-6-199" name="__codelineno-6-199" href="#__codelineno-6-199"></a>        <span class="s2">&quot;ankle&quot;</span><span class="p">:</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-6-200"><a id="__codelineno-6-200" name="__codelineno-6-200" href="#__codelineno-6-200"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;ankle&quot;</span><span class="p">,</span>
</span><span id="__span-6-201"><a id="__codelineno-6-201" name="__codelineno-6-201" href="#__codelineno-6-201"></a>            <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM1&quot;</span><span class="p">,</span>
</span><span id="__span-6-202"><a id="__codelineno-6-202" name="__codelineno-6-202" href="#__codelineno-6-202"></a>            <span class="n">gear_ratio</span><span class="o">=</span><span class="n">GEAR_RATIO</span><span class="p">,</span>
</span><span id="__span-6-203"><a id="__codelineno-6-203" name="__codelineno-6-203" href="#__codelineno-6-203"></a>            <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-6-204"><a id="__codelineno-6-204" name="__codelineno-6-204" href="#__codelineno-6-204"></a>            <span class="n">debug_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-6-205"><a id="__codelineno-6-205" name="__codelineno-6-205" href="#__codelineno-6-205"></a>            <span class="n">dephy_log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-206"><a id="__codelineno-6-206" name="__codelineno-6-206" href="#__codelineno-6-206"></a>        <span class="p">),</span>
</span><span id="__span-6-207"><a id="__codelineno-6-207" name="__codelineno-6-207" href="#__codelineno-6-207"></a>    <span class="p">}</span>
</span><span id="__span-6-208"><a id="__codelineno-6-208" name="__codelineno-6-208" href="#__codelineno-6-208"></a>
</span><span id="__span-6-209"><a id="__codelineno-6-209" name="__codelineno-6-209" href="#__codelineno-6-209"></a>    <span class="n">sensors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-210"><a id="__codelineno-6-210" name="__codelineno-6-210" href="#__codelineno-6-210"></a>        <span class="c1"># &quot;loadcell&quot;: DephyLoadcellAmplifier(</span>
</span><span id="__span-6-211"><a id="__codelineno-6-211" name="__codelineno-6-211" href="#__codelineno-6-211"></a>        <span class="c1">#     calibration_matrix=LOADCELL_CALIBRATION_MATRIX,</span>
</span><span id="__span-6-212"><a id="__codelineno-6-212" name="__codelineno-6-212" href="#__codelineno-6-212"></a>        <span class="c1"># ),</span>
</span><span id="__span-6-213"><a id="__codelineno-6-213" name="__codelineno-6-213" href="#__codelineno-6-213"></a>        <span class="s2">&quot;loadcell&quot;</span><span class="p">:</span> <span class="n">NBLoadcellDAQ</span><span class="p">(</span>
</span><span id="__span-6-214"><a id="__codelineno-6-214" name="__codelineno-6-214" href="#__codelineno-6-214"></a>            <span class="n">LOADCELL_CALIBRATION_MATRIX</span><span class="p">,</span>
</span><span id="__span-6-215"><a id="__codelineno-6-215" name="__codelineno-6-215" href="#__codelineno-6-215"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;loadcell&quot;</span><span class="p">,</span>
</span><span id="__span-6-216"><a id="__codelineno-6-216" name="__codelineno-6-216" href="#__codelineno-6-216"></a>            <span class="n">excitation_voltage</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span id="__span-6-217"><a id="__codelineno-6-217" name="__codelineno-6-217" href="#__codelineno-6-217"></a>            <span class="n">amp_gain</span><span class="o">=</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">151</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="__span-6-218"><a id="__codelineno-6-218" name="__codelineno-6-218" href="#__codelineno-6-218"></a>            <span class="n">spi_bus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-6-219"><a id="__codelineno-6-219" name="__codelineno-6-219" href="#__codelineno-6-219"></a>        <span class="p">),</span>
</span><span id="__span-6-220"><a id="__codelineno-6-220" name="__codelineno-6-220" href="#__codelineno-6-220"></a>        <span class="s2">&quot;joint_encoder_knee&quot;</span><span class="p">:</span> <span class="n">AS5048B</span><span class="p">(</span>
</span><span id="__span-6-221"><a id="__codelineno-6-221" name="__codelineno-6-221" href="#__codelineno-6-221"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;joint_encoder_knee&quot;</span><span class="p">,</span>
</span><span id="__span-6-222"><a id="__codelineno-6-222" name="__codelineno-6-222" href="#__codelineno-6-222"></a>            <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;/dev/i2c-2&quot;</span><span class="p">,</span>
</span><span id="__span-6-223"><a id="__codelineno-6-223" name="__codelineno-6-223" href="#__codelineno-6-223"></a>            <span class="n">A1_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-224"><a id="__codelineno-6-224" name="__codelineno-6-224" href="#__codelineno-6-224"></a>            <span class="n">A2_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-225"><a id="__codelineno-6-225" name="__codelineno-6-225" href="#__codelineno-6-225"></a>            <span class="n">zero_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-6-226"><a id="__codelineno-6-226" name="__codelineno-6-226" href="#__codelineno-6-226"></a>            <span class="n">enable_diagnostics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-227"><a id="__codelineno-6-227" name="__codelineno-6-227" href="#__codelineno-6-227"></a>        <span class="p">),</span>
</span><span id="__span-6-228"><a id="__codelineno-6-228" name="__codelineno-6-228" href="#__codelineno-6-228"></a>        <span class="s2">&quot;joint_encoder_ankle&quot;</span><span class="p">:</span> <span class="n">AS5048B</span><span class="p">(</span>
</span><span id="__span-6-229"><a id="__codelineno-6-229" name="__codelineno-6-229" href="#__codelineno-6-229"></a>            <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;joint_encoder_ankle&quot;</span><span class="p">,</span>
</span><span id="__span-6-230"><a id="__codelineno-6-230" name="__codelineno-6-230" href="#__codelineno-6-230"></a>            <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;/dev/i2c-3&quot;</span><span class="p">,</span>
</span><span id="__span-6-231"><a id="__codelineno-6-231" name="__codelineno-6-231" href="#__codelineno-6-231"></a>            <span class="n">A1_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-232"><a id="__codelineno-6-232" name="__codelineno-6-232" href="#__codelineno-6-232"></a>            <span class="n">A2_adr_pin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-233"><a id="__codelineno-6-233" name="__codelineno-6-233" href="#__codelineno-6-233"></a>            <span class="n">zero_position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-6-234"><a id="__codelineno-6-234" name="__codelineno-6-234" href="#__codelineno-6-234"></a>            <span class="n">enable_diagnostics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-6-235"><a id="__codelineno-6-235" name="__codelineno-6-235" href="#__codelineno-6-235"></a>        <span class="p">),</span>
</span><span id="__span-6-236"><a id="__codelineno-6-236" name="__codelineno-6-236" href="#__codelineno-6-236"></a>    <span class="p">}</span>
</span><span id="__span-6-237"><a id="__codelineno-6-237" name="__codelineno-6-237" href="#__codelineno-6-237"></a>
</span><span id="__span-6-238"><a id="__codelineno-6-238" name="__codelineno-6-238" href="#__codelineno-6-238"></a>    <span class="n">clock</span> <span class="o">=</span> <span class="n">SoftRealtimeLoop</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">FREQUENCY</span><span class="p">)</span>
</span><span id="__span-6-239"><a id="__codelineno-6-239" name="__codelineno-6-239" href="#__codelineno-6-239"></a>    <span class="n">fsm_logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span>
</span><span id="__span-6-240"><a id="__codelineno-6-240" name="__codelineno-6-240" href="#__codelineno-6-240"></a>        <span class="n">log_path</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span>
</span><span id="__span-6-241"><a id="__codelineno-6-241" name="__codelineno-6-241" href="#__codelineno-6-241"></a>        <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;fsm.log&quot;</span><span class="p">,</span>
</span><span id="__span-6-242"><a id="__codelineno-6-242" name="__codelineno-6-242" href="#__codelineno-6-242"></a>    <span class="p">)</span>
</span><span id="__span-6-243"><a id="__codelineno-6-243" name="__codelineno-6-243" href="#__codelineno-6-243"></a>
</span><span id="__span-6-244"><a id="__codelineno-6-244" name="__codelineno-6-244" href="#__codelineno-6-244"></a>    <span class="n">osl</span> <span class="o">=</span> <span class="n">OpenSourceLeg</span><span class="p">(</span>
</span><span id="__span-6-245"><a id="__codelineno-6-245" name="__codelineno-6-245" href="#__codelineno-6-245"></a>        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;osl&quot;</span><span class="p">,</span>
</span><span id="__span-6-246"><a id="__codelineno-6-246" name="__codelineno-6-246" href="#__codelineno-6-246"></a>        <span class="n">actuators</span><span class="o">=</span><span class="n">actuators</span><span class="p">,</span>
</span><span id="__span-6-247"><a id="__codelineno-6-247" name="__codelineno-6-247" href="#__codelineno-6-247"></a>        <span class="n">sensors</span><span class="o">=</span><span class="n">sensors</span><span class="p">,</span>
</span><span id="__span-6-248"><a id="__codelineno-6-248" name="__codelineno-6-248" href="#__codelineno-6-248"></a>    <span class="p">)</span>
</span><span id="__span-6-249"><a id="__codelineno-6-249" name="__codelineno-6-249" href="#__codelineno-6-249"></a>
</span><span id="__span-6-250"><a id="__codelineno-6-250" name="__codelineno-6-250" href="#__codelineno-6-250"></a>    <span class="n">osl_fsm</span> <span class="o">=</span> <span class="n">create_simple_walking_fsm</span><span class="p">(</span><span class="n">osl</span><span class="p">)</span>
</span><span id="__span-6-251"><a id="__codelineno-6-251" name="__codelineno-6-251" href="#__codelineno-6-251"></a>
</span><span id="__span-6-252"><a id="__codelineno-6-252" name="__codelineno-6-252" href="#__codelineno-6-252"></a>    <span class="c1"># Zeroing the joint encoders</span>
</span><span id="__span-6-253"><a id="__codelineno-6-253" name="__codelineno-6-253" href="#__codelineno-6-253"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">knee_homing_complete</span><span class="p">():</span>
</span><span id="__span-6-254"><a id="__codelineno-6-254" name="__codelineno-6-254" href="#__codelineno-6-254"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_knee</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-6-255"><a id="__codelineno-6-255" name="__codelineno-6-255" href="#__codelineno-6-255"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_knee</span><span class="o">.</span><span class="n">zero_position</span> <span class="o">=</span> <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_knee</span><span class="o">.</span><span class="n">counts</span>
</span><span id="__span-6-256"><a id="__codelineno-6-256" name="__codelineno-6-256" href="#__codelineno-6-256"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Knee homing complete!&quot;</span><span class="p">)</span>
</span><span id="__span-6-257"><a id="__codelineno-6-257" name="__codelineno-6-257" href="#__codelineno-6-257"></a>
</span><span id="__span-6-258"><a id="__codelineno-6-258" name="__codelineno-6-258" href="#__codelineno-6-258"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ankle_homing_complete</span><span class="p">():</span>
</span><span id="__span-6-259"><a id="__codelineno-6-259" name="__codelineno-6-259" href="#__codelineno-6-259"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-6-260"><a id="__codelineno-6-260" name="__codelineno-6-260" href="#__codelineno-6-260"></a>        <span class="c1"># The hard stop for ankle is at 30 deg from the zero position</span>
</span><span id="__span-6-261"><a id="__codelineno-6-261" name="__codelineno-6-261" href="#__codelineno-6-261"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">zero_position</span> <span class="o">=</span> <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">counts</span> <span class="o">-</span> <span class="n">osl</span><span class="o">.</span><span class="n">joint_encoder_ankle</span><span class="o">.</span><span class="n">deg_to_counts</span><span class="p">(</span>
</span><span id="__span-6-262"><a id="__codelineno-6-262" name="__codelineno-6-262" href="#__codelineno-6-262"></a>            <span class="mi">30</span>
</span><span id="__span-6-263"><a id="__codelineno-6-263" name="__codelineno-6-263" href="#__codelineno-6-263"></a>        <span class="p">)</span>
</span><span id="__span-6-264"><a id="__codelineno-6-264" name="__codelineno-6-264" href="#__codelineno-6-264"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ankle homing complete!&quot;</span><span class="p">)</span>
</span><span id="__span-6-265"><a id="__codelineno-6-265" name="__codelineno-6-265" href="#__codelineno-6-265"></a>
</span><span id="__span-6-266"><a id="__codelineno-6-266" name="__codelineno-6-266" href="#__codelineno-6-266"></a>    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;knee&quot;</span><span class="p">:</span> <span class="n">knee_homing_complete</span><span class="p">,</span> <span class="s2">&quot;ankle&quot;</span><span class="p">:</span> <span class="n">ankle_homing_complete</span><span class="p">}</span>
</span><span id="__span-6-267"><a id="__codelineno-6-267" name="__codelineno-6-267" href="#__codelineno-6-267"></a>
</span><span id="__span-6-268"><a id="__codelineno-6-268" name="__codelineno-6-268" href="#__codelineno-6-268"></a>    <span class="k">with</span> <span class="n">osl</span><span class="p">,</span> <span class="n">osl_fsm</span><span class="p">:</span>
</span><span id="__span-6-269"><a id="__codelineno-6-269" name="__codelineno-6-269" href="#__codelineno-6-269"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-6-270"><a id="__codelineno-6-270" name="__codelineno-6-270" href="#__codelineno-6-270"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">home</span><span class="p">(</span><span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>
</span><span id="__span-6-271"><a id="__codelineno-6-271" name="__codelineno-6-271" href="#__codelineno-6-271"></a>        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press Enter to start walking...&quot;</span><span class="p">)</span>
</span><span id="__span-6-272"><a id="__codelineno-6-272" name="__codelineno-6-272" href="#__codelineno-6-272"></a>
</span><span id="__span-6-273"><a id="__codelineno-6-273" name="__codelineno-6-273" href="#__codelineno-6-273"></a>        <span class="c1"># knee</span>
</span><span id="__span-6-274"><a id="__codelineno-6-274" name="__codelineno-6-274" href="#__codelineno-6-274"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-6-275"><a id="__codelineno-6-275" name="__codelineno-6-275" href="#__codelineno-6-275"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-6-276"><a id="__codelineno-6-276" name="__codelineno-6-276" href="#__codelineno-6-276"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">()</span>
</span><span id="__span-6-277"><a id="__codelineno-6-277" name="__codelineno-6-277" href="#__codelineno-6-277"></a>
</span><span id="__span-6-278"><a id="__codelineno-6-278" name="__codelineno-6-278" href="#__codelineno-6-278"></a>        <span class="c1"># ankle</span>
</span><span id="__span-6-279"><a id="__codelineno-6-279" name="__codelineno-6-279" href="#__codelineno-6-279"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-6-280"><a id="__codelineno-6-280" name="__codelineno-6-280" href="#__codelineno-6-280"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-6-281"><a id="__codelineno-6-281" name="__codelineno-6-281" href="#__codelineno-6-281"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">()</span>
</span><span id="__span-6-282"><a id="__codelineno-6-282" name="__codelineno-6-282" href="#__codelineno-6-282"></a>
</span><span id="__span-6-283"><a id="__codelineno-6-283" name="__codelineno-6-283" href="#__codelineno-6-283"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="__span-6-284"><a id="__codelineno-6-284" name="__codelineno-6-284" href="#__codelineno-6-284"></a>        <span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
</span><span id="__span-6-285"><a id="__codelineno-6-285" name="__codelineno-6-285" href="#__codelineno-6-285"></a>
</span><span id="__span-6-286"><a id="__codelineno-6-286" name="__codelineno-6-286" href="#__codelineno-6-286"></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">clock</span><span class="p">:</span>
</span><span id="__span-6-287"><a id="__codelineno-6-287" name="__codelineno-6-287" href="#__codelineno-6-287"></a>            <span class="n">osl</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-6-288"><a id="__codelineno-6-288" name="__codelineno-6-288" href="#__codelineno-6-288"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ankle position&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;joint_encoder_ankle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">))</span>
</span><span id="__span-6-289"><a id="__codelineno-6-289" name="__codelineno-6-289" href="#__codelineno-6-289"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Knee position&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">sensors</span><span class="p">[</span><span class="s2">&quot;joint_encoder_knee&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">))</span>
</span><span id="__span-6-290"><a id="__codelineno-6-290" name="__codelineno-6-290" href="#__codelineno-6-290"></a>            <span class="n">osl_fsm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">osl</span><span class="o">=</span><span class="n">osl</span><span class="p">)</span>
</span><span id="__span-6-291"><a id="__codelineno-6-291" name="__codelineno-6-291" href="#__codelineno-6-291"></a>            <span class="c1"># osl.knee.set_output_impedance(</span>
</span><span id="__span-6-292"><a id="__codelineno-6-292" name="__codelineno-6-292" href="#__codelineno-6-292"></a>            <span class="c1">#     k=osl_fsm.current_state.knee_stiffness,</span>
</span><span id="__span-6-293"><a id="__codelineno-6-293" name="__codelineno-6-293" href="#__codelineno-6-293"></a>            <span class="c1">#     b=osl_fsm.current_state.knee_damping,</span>
</span><span id="__span-6-294"><a id="__codelineno-6-294" name="__codelineno-6-294" href="#__codelineno-6-294"></a>            <span class="c1"># )</span>
</span><span id="__span-6-295"><a id="__codelineno-6-295" name="__codelineno-6-295" href="#__codelineno-6-295"></a>            <span class="c1"># osl.ankle.set_output_impedance(</span>
</span><span id="__span-6-296"><a id="__codelineno-6-296" name="__codelineno-6-296" href="#__codelineno-6-296"></a>            <span class="c1">#     k=osl_fsm.current_state.ankle_stiffness,</span>
</span><span id="__span-6-297"><a id="__codelineno-6-297" name="__codelineno-6-297" href="#__codelineno-6-297"></a>            <span class="c1">#     b=osl_fsm.current_state.ankle_damping,</span>
</span><span id="__span-6-298"><a id="__codelineno-6-298" name="__codelineno-6-298" href="#__codelineno-6-298"></a>            <span class="c1"># )</span>
</span><span id="__span-6-299"><a id="__codelineno-6-299" name="__codelineno-6-299" href="#__codelineno-6-299"></a>
</span><span id="__span-6-300"><a id="__codelineno-6-300" name="__codelineno-6-300" href="#__codelineno-6-300"></a>            <span class="c1"># osl.knee.set_output_position(np.deg2rad(osl_fsm.current_state.knee_theta))</span>
</span><span id="__span-6-301"><a id="__codelineno-6-301" name="__codelineno-6-301" href="#__codelineno-6-301"></a>            <span class="c1"># osl.ankle.set_output_position(np.deg2rad(osl_fsm.current_state.ankle_theta))</span>
</span><span id="__span-6-302"><a id="__codelineno-6-302" name="__codelineno-6-302" href="#__codelineno-6-302"></a>
</span><span id="__span-6-303"><a id="__codelineno-6-303" name="__codelineno-6-303" href="#__codelineno-6-303"></a>            <span class="n">fsm_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-6-304"><a id="__codelineno-6-304" name="__codelineno-6-304" href="#__codelineno-6-304"></a>                <span class="sa">f</span><span class="s2">&quot;T: </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s, &quot;</span>
</span><span id="__span-6-305"><a id="__codelineno-6-305" name="__codelineno-6-305" href="#__codelineno-6-305"></a>                <span class="sa">f</span><span class="s2">&quot;Current state: </span><span class="si">{</span><span class="n">osl_fsm</span><span class="o">.</span><span class="n">current_state</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">; &quot;</span>
</span><span id="__span-6-306"><a id="__codelineno-6-306" name="__codelineno-6-306" href="#__codelineno-6-306"></a>                <span class="sa">f</span><span class="s2">&quot;Loadcell Fz: </span><span class="si">{</span><span class="n">osl</span><span class="o">.</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> N; &quot;</span>
</span><span id="__span-6-307"><a id="__codelineno-6-307" name="__codelineno-6-307" href="#__codelineno-6-307"></a>                <span class="sa">f</span><span class="s2">&quot;Knee theta: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> deg; &quot;</span>
</span><span id="__span-6-308"><a id="__codelineno-6-308" name="__codelineno-6-308" href="#__codelineno-6-308"></a>                <span class="sa">f</span><span class="s2">&quot;Ankle theta: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">output_position</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> deg; &quot;</span>
</span><span id="__span-6-309"><a id="__codelineno-6-309" name="__codelineno-6-309" href="#__codelineno-6-309"></a>                <span class="sa">f</span><span class="s2">&quot;Knee winding temperature: </span><span class="si">{</span><span class="n">osl</span><span class="o">.</span><span class="n">knee</span><span class="o">.</span><span class="n">winding_temperature</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> c; &quot;</span>
</span><span id="__span-6-310"><a id="__codelineno-6-310" name="__codelineno-6-310" href="#__codelineno-6-310"></a>                <span class="sa">f</span><span class="s2">&quot;Ankle winding temperature: </span><span class="si">{</span><span class="n">osl</span><span class="o">.</span><span class="n">ankle</span><span class="o">.</span><span class="n">winding_temperature</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> c; &quot;</span>
</span><span id="__span-6-311"><a id="__codelineno-6-311" name="__codelineno-6-311" href="#__codelineno-6-311"></a>            <span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="c-and-matlab-implementation">C++ and MATLAB Implementation<a class="headerlink" href="#c-and-matlab-implementation" title="Permanent link">&para;</a></h2>
<p>To get started, ensure you have compiled either the <code>C++</code> or <code>MATLAB</code> source code and have a <code>FSMController.so</code> library. If not, refer to the <a href="https://github.com/neurobionics/OSL_CompiledControllers_Source">source repository</a> for compilation instructions. To run this example, make sure the generated library is in the same directory as your script, or modify the search path for the library when loading the controller.</p>
<hr />
<h3 id="load-compiled-library">Load Compiled Library<a class="headerlink" href="#load-compiled-library" title="Permanent link">&para;</a></h3>
<p>First, perform standard imports, handle paths, and set up the hardware for the OSL joints and sensors</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.actuators.dephy</span><span class="w"> </span><span class="kn">import</span> <span class="n">DephyActuator</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.control.compiled</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompiledController</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.sensors.loadcell</span><span class="w"> </span><span class="kn">import</span> <span class="n">DephyLoadcellAmplifier</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftRealtimeLoop</span><span class="p">,</span> <span class="n">units</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">use_offline_mode</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="n">FREQUENCY</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="n">clock</span> <span class="o">=</span> <span class="n">SoftRealtimeLoop</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">FREQUENCY</span><span class="p">)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">knee</span> <span class="o">=</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;knee&quot;</span><span class="p">,</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="n">firmware_version</span><span class="o">=</span><span class="s2">&quot;7.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM0&quot;</span><span class="p">,</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="n">gear_ratio</span><span class="o">=</span><span class="mi">9</span> <span class="o">*</span> <span class="mi">83</span> <span class="o">/</span> <span class="mi">18</span><span class="p">,</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="p">)</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="n">ankle</span> <span class="o">=</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;ankle&quot;</span><span class="p">,</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>    <span class="n">firmware_version</span><span class="o">=</span><span class="s2">&quot;7.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>    <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM1&quot;</span><span class="p">,</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>    <span class="n">gear_ratio</span><span class="o">=</span><span class="mi">9</span> <span class="o">*</span> <span class="mi">83</span> <span class="o">/</span> <span class="mi">18</span><span class="p">,</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="p">)</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="n">actuators</span> <span class="o">=</span> <span class="p">[</span><span class="n">knee</span><span class="p">,</span> <span class="n">ankle</span><span class="p">]</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="n">LOADCELL_MATRIX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">38.72600</span><span class="p">,</span> <span class="o">-</span><span class="mf">1817.74700</span><span class="p">,</span> <span class="mf">9.84900</span><span class="p">,</span> <span class="mf">43.37400</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.54000</span><span class="p">,</span> <span class="mf">1824.67000</span><span class="p">),</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">8.61600</span><span class="p">,</span> <span class="mf">1041.14900</span><span class="p">,</span> <span class="mf">18.86100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2098.82200</span><span class="p">,</span> <span class="mf">31.79400</span><span class="p">,</span> <span class="mf">1058.6230</span><span class="p">),</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">1047.16800</span><span class="p">,</span> <span class="mf">8.63900</span><span class="p">,</span> <span class="o">-</span><span class="mf">1047.28200</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.70000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1073.08800</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.92300</span><span class="p">),</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>    <span class="p">(</span><span class="mf">20.57600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24600</span><span class="p">,</span> <span class="mf">0.55400</span><span class="p">,</span> <span class="o">-</span><span class="mf">21.40800</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.47600</span><span class="p">),</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">12.13400</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.10800</span><span class="p">,</span> <span class="mf">24.36100</span><span class="p">,</span> <span class="mf">0.02300</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.14100</span><span class="p">,</span> <span class="mf">0.79200</span><span class="p">),</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">0.65100</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.28700</span><span class="p">,</span> <span class="mf">0.02200</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.23000</span><span class="p">,</span> <span class="mf">0.47300</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.3070</span><span class="p">),</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="p">])</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="n">loadcell</span> <span class="o">=</span> <span class="n">DephyLoadcellAmplifier</span><span class="p">(</span>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>    <span class="n">calibration_matrix</span><span class="o">=</span><span class="n">LOADCELL_MATRIX</span><span class="p">,</span>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>    <span class="n">bus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="p">)</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">loadcell</span><span class="p">]</span>
</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>:
If instantiating the OSL hardware and sensors is unfamiliar, check out the <a href="../../tutorials/actuators/getting_started/">the tutorials pages</a>.</p>
</blockquote>
<p>Next, instantiate a <code>CompiledController</code> wrapper object:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">currentdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())))</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">controller</span> <span class="o">=</span> <span class="n">CompiledController</span><span class="p">(</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">library_name</span><span class="o">=</span><span class="s2">&quot;FSMController&quot;</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">library_path</span><span class="o">=</span><span class="n">currentdir</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">main_function_name</span><span class="o">=</span><span class="s2">&quot;FSMController&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">initialization_function_name</span><span class="o">=</span><span class="s2">&quot;FSMController_initialize&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">cleanup_function_name</span><span class="o">=</span><span class="s2">&quot;FSMController_terminate&quot;</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="define-custom-datatypes">Define Custom Datatypes<a class="headerlink" href="#define-custom-datatypes" title="Permanent link">&para;</a></h3>
<p>Define the data structures used in the controller. These must match the size and order of the structures used to create the library.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="s2">&quot;impedance_param_type&quot;</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="p">[</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>        <span class="p">(</span><span class="s2">&quot;stiffness&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>        <span class="p">(</span><span class="s2">&quot;damping&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>        <span class="p">(</span><span class="s2">&quot;eq_angle&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="p">],</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">)</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="s2">&quot;joint_impedance_set&quot;</span><span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="p">[</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>        <span class="p">(</span><span class="s2">&quot;early_stance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>        <span class="p">(</span><span class="s2">&quot;late_stance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="p">(</span><span class="s2">&quot;early_swing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>        <span class="p">(</span><span class="s2">&quot;late_swing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="p">],</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="p">)</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="s2">&quot;transition_parameters&quot;</span><span class="p">,</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="p">[</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="p">(</span><span class="s2">&quot;min_time_in_state&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        <span class="p">(</span><span class="s2">&quot;loadLStance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>        <span class="p">(</span><span class="s2">&quot;ankleThetaEstanceToLstance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>        <span class="p">(</span><span class="s2">&quot;kneeThetaESwingToLSwing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>        <span class="p">(</span><span class="s2">&quot;kneeDthetaESwingToLSwing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>        <span class="p">(</span><span class="s2">&quot;loadESwing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>        <span class="p">(</span><span class="s2">&quot;loadEStance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>        <span class="p">(</span><span class="s2">&quot;kneeThetaLSwingToEStance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="p">],</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="p">)</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>    <span class="s2">&quot;UserParameters&quot;</span><span class="p">,</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>    <span class="p">[</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>        <span class="p">(</span><span class="s2">&quot;body_weight&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>        <span class="p">(</span><span class="s2">&quot;knee_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">joint_impedance_set</span><span class="p">),</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>        <span class="p">(</span><span class="s2">&quot;ankle_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">joint_impedance_set</span><span class="p">),</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>        <span class="p">(</span><span class="s2">&quot;transition_parameters&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">transition_parameters</span><span class="p">),</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>    <span class="p">],</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="p">)</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span><span class="s2">&quot;sensors&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">DEFAULT_SENSOR_LIST</span><span class="p">)</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_inputs</span><span class="p">([</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">UserParameters</span><span class="p">),</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>    <span class="p">(</span><span class="s2">&quot;sensors&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">sensors</span><span class="p">),</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>    <span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="p">])</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_outputs</span><span class="p">([</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>    <span class="p">(</span><span class="s2">&quot;current_state&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_int</span><span class="p">),</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>    <span class="p">(</span><span class="s2">&quot;time_in_current_state&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>    <span class="p">(</span><span class="s2">&quot;knee_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>    <span class="p">(</span><span class="s2">&quot;ankle_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="p">])</span>
</span></code></pre></div>
<hr />
<h3 id="configure-impedance-and-transition-parameters">Configure Impedance and Transition Parameters<a class="headerlink" href="#configure-impedance-and-transition-parameters" title="Permanent link">&para;</a></h3>
<p>Configure the impedance and transition parameters based on predefined tuning. Adjust these values to achieve the desired behavior:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">3.180</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">1.272</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">39.746</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">15.899</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">3.186</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">19.874</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">79.498</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="c1"># Configure state machine</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="n">body_weight</span> <span class="o">=</span> <span class="mi">82</span>  <span class="c1"># kg</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">body_weight</span> <span class="o">=</span> <span class="n">body_weight</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">min_time_in_state</span> <span class="o">=</span> <span class="mf">0.20</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">loadLStance</span> <span class="o">=</span> <span class="o">-</span><span class="n">body_weight</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">ankleThetaEstanceToLstance</span> <span class="o">=</span> <span class="mf">6.0</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">loadESwing</span> <span class="o">=</span> <span class="o">-</span><span class="n">body_weight</span> <span class="o">*</span> <span class="mf">0.15</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">kneeThetaESwingToLSwing</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">kneeDthetaESwingToLSwing</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">loadEStance</span> <span class="o">=</span> <span class="o">-</span><span class="n">body_weight</span> <span class="o">*</span> <span class="mf">0.4</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">kneeThetaLSwingToEStance</span> <span class="o">=</span> <span class="mi">30</span>
</span></code></pre></div>
<hr />
<h3 id="main-loop_1">Main Loop<a class="headerlink" href="#main-loop_1" title="Permanent link">&para;</a></h3>
<p>After configuration, home the OSL joints, calibrate the loadcell, set the joints to impedance mode, and begin running the controller. During each loop iteration, update the inputs, call the <code>run()</code> method, and write outputs to the hardware:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">with</span> <span class="n">knee</span><span class="p">,</span> <span class="n">ankle</span><span class="p">,</span> <span class="n">loadcell</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="n">knee</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">ankle</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">knee</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">knee</span><span class="o">.</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">ankle</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">ankle</span><span class="o">.</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="n">knee</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">ankle</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="c1"># Main Loop</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">clock</span><span class="p">:</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="n">knee</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="n">ankle</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>        <span class="n">loadcell</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">knee_angle</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">ankle_angle</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span><span class="n">ankle</span><span class="o">.</span><span class="n">output_position</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">knee_velocity</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>            <span class="n">knee</span><span class="o">.</span><span class="n">output_velocity</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Velocity</span><span class="o">.</span><span class="n">deg_per_s</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        <span class="p">)</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">ankle_velocity</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>            <span class="n">ankle</span><span class="o">.</span><span class="n">output_velocity</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Velocity</span><span class="o">.</span><span class="n">deg_per_s</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>        <span class="p">)</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">Fz</span> <span class="o">=</span> <span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>        <span class="c1"># Update any control inputs that change every loop</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">t</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>        <span class="c1"># Call the controller</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>        <span class="c1"># Test print to ensure external library call works</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>            <span class="sa">f</span><span class="s2">&quot;Current time in state </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">current_state</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">time_in_current_state</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds, </span><span class="se">\</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="s2">                Knee Eq </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="s2">                Ankle Eq </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="s2">                Fz </span><span class="si">{</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>        <span class="p">)</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>        <span class="c1"># Write to the hardware</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>        <span class="n">knee</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">(</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>            <span class="n">k</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Stiffness</span><span class="o">.</span><span class="n">N_m_per_rad</span><span class="p">),</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>            <span class="n">b</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Damping</span><span class="o">.</span><span class="n">N_m_per_rad_per_s</span><span class="p">),</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>        <span class="p">)</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>        <span class="n">knee</span><span class="o">.</span><span class="n">set_output_position</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>        <span class="n">ankle</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">(</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>            <span class="n">k</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Stiffness</span><span class="o">.</span><span class="n">N_m_per_rad</span><span class="p">),</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>            <span class="n">b</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Damping</span><span class="o">.</span><span class="n">N_m_per_rad_per_s</span><span class="p">),</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>        <span class="p">)</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>        <span class="n">ankle</span><span class="o">.</span><span class="n">set_output_position</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>:
Be careful with units when writing outputs to the hardware. Convert values to the appropriate units if necessary.</p>
</blockquote>
<hr />
<h3 id="full-code-for-the-compiled-controller-implementation">Full Code for The Compiled Controller Implementation<a class="headerlink" href="#full-code-for-the-compiled-controller-implementation" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="sd">Example walking controller for the OSL.</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">Senthur Raj Ayyappan, Kevin Best</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">Neurobionics Lab</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">Robotics Department</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="sd">University of Michigan</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="sd">October 9, 2023</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.actuators.dephy</span><span class="w"> </span><span class="kn">import</span> <span class="n">DephyActuator</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.control.compiled</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompiledController</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.sensors.loadcell</span><span class="w"> </span><span class="kn">import</span> <span class="n">DephyLoadcellAmplifier</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opensourceleg.utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">SoftRealtimeLoop</span><span class="p">,</span> <span class="n">units</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="n">use_offline_mode</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="n">FREQUENCY</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="n">clock</span> <span class="o">=</span> <span class="n">SoftRealtimeLoop</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">FREQUENCY</span><span class="p">)</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="n">knee</span> <span class="o">=</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;knee&quot;</span><span class="p">,</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>    <span class="n">firmware_version</span><span class="o">=</span><span class="s2">&quot;7.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>    <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM0&quot;</span><span class="p">,</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>    <span class="n">gear_ratio</span><span class="o">=</span><span class="mi">9</span> <span class="o">*</span> <span class="mi">83</span> <span class="o">/</span> <span class="mi">18</span><span class="p">,</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>    <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="p">)</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="n">ankle</span> <span class="o">=</span> <span class="n">DephyActuator</span><span class="p">(</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>    <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;ankle&quot;</span><span class="p">,</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>    <span class="n">firmware_version</span><span class="o">=</span><span class="s2">&quot;7.2.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>    <span class="n">port</span><span class="o">=</span><span class="s2">&quot;/dev/ttyACM1&quot;</span><span class="p">,</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>    <span class="n">gear_ratio</span><span class="o">=</span><span class="mi">9</span> <span class="o">*</span> <span class="mi">83</span> <span class="o">/</span> <span class="mi">18</span><span class="p">,</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>    <span class="n">frequency</span><span class="o">=</span><span class="n">FREQUENCY</span><span class="p">,</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="p">)</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a><span class="n">actuators</span> <span class="o">=</span> <span class="p">[</span><span class="n">knee</span><span class="p">,</span> <span class="n">ankle</span><span class="p">]</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a><span class="n">LOADCELL_MATRIX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">38.72600</span><span class="p">,</span> <span class="o">-</span><span class="mf">1817.74700</span><span class="p">,</span> <span class="mf">9.84900</span><span class="p">,</span> <span class="mf">43.37400</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.54000</span><span class="p">,</span> <span class="mf">1824.67000</span><span class="p">),</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">8.61600</span><span class="p">,</span> <span class="mf">1041.14900</span><span class="p">,</span> <span class="mf">18.86100</span><span class="p">,</span> <span class="o">-</span><span class="mf">2098.82200</span><span class="p">,</span> <span class="mf">31.79400</span><span class="p">,</span> <span class="mf">1058.6230</span><span class="p">),</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">1047.16800</span><span class="p">,</span> <span class="mf">8.63900</span><span class="p">,</span> <span class="o">-</span><span class="mf">1047.28200</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.70000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1073.08800</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.92300</span><span class="p">),</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>    <span class="p">(</span><span class="mf">20.57600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24600</span><span class="p">,</span> <span class="mf">0.55400</span><span class="p">,</span> <span class="o">-</span><span class="mf">21.40800</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.47600</span><span class="p">),</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">12.13400</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.10800</span><span class="p">,</span> <span class="mf">24.36100</span><span class="p">,</span> <span class="mf">0.02300</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.14100</span><span class="p">,</span> <span class="mf">0.79200</span><span class="p">),</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>    <span class="p">(</span><span class="o">-</span><span class="mf">0.65100</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.28700</span><span class="p">,</span> <span class="mf">0.02200</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.23000</span><span class="p">,</span> <span class="mf">0.47300</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.3070</span><span class="p">),</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a><span class="p">])</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a><span class="n">loadcell</span> <span class="o">=</span> <span class="n">DephyLoadcellAmplifier</span><span class="p">(</span>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>    <span class="n">calibration_matrix</span><span class="o">=</span><span class="n">LOADCELL_MATRIX</span><span class="p">,</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>    <span class="n">bus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a><span class="p">)</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">loadcell</span><span class="p">]</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a><span class="n">currentdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">())))</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a><span class="n">controller</span> <span class="o">=</span> <span class="n">CompiledController</span><span class="p">(</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a>    <span class="n">library_name</span><span class="o">=</span><span class="s2">&quot;FSMController&quot;</span><span class="p">,</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>    <span class="n">library_path</span><span class="o">=</span><span class="n">currentdir</span><span class="p">,</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a>    <span class="n">main_function_name</span><span class="o">=</span><span class="s2">&quot;FSMController&quot;</span><span class="p">,</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>    <span class="n">initialization_function_name</span><span class="o">=</span><span class="s2">&quot;FSMController_initialize&quot;</span><span class="p">,</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a>    <span class="n">cleanup_function_name</span><span class="o">=</span><span class="s2">&quot;FSMController_terminate&quot;</span><span class="p">,</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a><span class="p">)</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a>    <span class="s2">&quot;impedance_param_type&quot;</span><span class="p">,</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>    <span class="p">[</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>        <span class="p">(</span><span class="s2">&quot;stiffness&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>        <span class="p">(</span><span class="s2">&quot;damping&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a>        <span class="p">(</span><span class="s2">&quot;eq_angle&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a>    <span class="p">],</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a><span class="p">)</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a>    <span class="s2">&quot;joint_impedance_set&quot;</span><span class="p">,</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>    <span class="p">[</span>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a>        <span class="p">(</span><span class="s2">&quot;early_stance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a>        <span class="p">(</span><span class="s2">&quot;late_stance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a>        <span class="p">(</span><span class="s2">&quot;early_swing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a>        <span class="p">(</span><span class="s2">&quot;late_swing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>    <span class="p">],</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a><span class="p">)</span>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>    <span class="s2">&quot;transition_parameters&quot;</span><span class="p">,</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>    <span class="p">[</span>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a>        <span class="p">(</span><span class="s2">&quot;min_time_in_state&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a>        <span class="p">(</span><span class="s2">&quot;loadLStance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a>        <span class="p">(</span><span class="s2">&quot;ankleThetaEstanceToLstance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a>        <span class="p">(</span><span class="s2">&quot;kneeThetaESwingToLSwing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a>        <span class="p">(</span><span class="s2">&quot;kneeDthetaESwingToLSwing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a>        <span class="p">(</span><span class="s2">&quot;loadESwing&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a>        <span class="p">(</span><span class="s2">&quot;loadEStance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>        <span class="p">(</span><span class="s2">&quot;kneeThetaLSwingToEStance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a>    <span class="p">],</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a><span class="p">)</span>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>    <span class="s2">&quot;UserParameters&quot;</span><span class="p">,</span>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>    <span class="p">[</span>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a>        <span class="p">(</span><span class="s2">&quot;body_weight&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>        <span class="p">(</span><span class="s2">&quot;knee_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">joint_impedance_set</span><span class="p">),</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>        <span class="p">(</span><span class="s2">&quot;ankle_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">joint_impedance_set</span><span class="p">),</span>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a>        <span class="p">(</span><span class="s2">&quot;transition_parameters&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">transition_parameters</span><span class="p">),</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>    <span class="p">],</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a><span class="p">)</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_type</span><span class="p">(</span><span class="s2">&quot;sensors&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">DEFAULT_SENSOR_LIST</span><span class="p">)</span>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_inputs</span><span class="p">([</span>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a>    <span class="p">(</span><span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">UserParameters</span><span class="p">),</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a>    <span class="p">(</span><span class="s2">&quot;sensors&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">sensors</span><span class="p">),</span>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a>    <span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a><span class="p">])</span>
</span><span id="__span-12-115"><a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a><span class="n">controller</span><span class="o">.</span><span class="n">define_outputs</span><span class="p">([</span>
</span><span id="__span-12-116"><a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a>    <span class="p">(</span><span class="s2">&quot;current_state&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_int</span><span class="p">),</span>
</span><span id="__span-12-117"><a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>    <span class="p">(</span><span class="s2">&quot;time_in_current_state&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
</span><span id="__span-12-118"><a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>    <span class="p">(</span><span class="s2">&quot;knee_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-12-119"><a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a>    <span class="p">(</span><span class="s2">&quot;ankle_impedance&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">impedance_param_type</span><span class="p">),</span>
</span><span id="__span-12-120"><a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a><span class="p">])</span>
</span><span id="__span-12-121"><a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>
</span><span id="__span-12-122"><a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a><span class="c1"># Populate Controller inputs as needed</span>
</span><span id="__span-12-123"><a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-12-124"><a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">3.180</span>
</span><span id="__span-12-125"><a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-12-126"><a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">99.372</span>
</span><span id="__span-12-127"><a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">1.272</span>
</span><span id="__span-12-128"><a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="__span-12-129"><a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">39.746</span>
</span><span id="__span-12-130"><a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-12-131"><a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="__span-12-132"><a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">15.899</span>
</span><span id="__span-12-133"><a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">3.186</span>
</span><span id="__span-12-134"><a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-12-135"><a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">19.874</span>
</span><span id="__span-12-136"><a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-12-137"><a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
</span><span id="__span-12-138"><a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">79.498</span>
</span><span id="__span-12-139"><a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.063</span>
</span><span id="__span-12-140"><a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_stance</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
</span><span id="__span-12-141"><a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-12-142"><a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-12-143"><a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">early_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="__span-12-144"><a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">stiffness</span> <span class="o">=</span> <span class="mf">7.949</span>
</span><span id="__span-12-145"><a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">damping</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-12-146"><a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">late_swing</span><span class="o">.</span><span class="n">eq_angle</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="__span-12-147"><a id="__codelineno-12-147" name="__codelineno-12-147" href="#__codelineno-12-147"></a>
</span><span id="__span-12-148"><a id="__codelineno-12-148" name="__codelineno-12-148" href="#__codelineno-12-148"></a><span class="c1"># Configure state machine</span>
</span><span id="__span-12-149"><a id="__codelineno-12-149" name="__codelineno-12-149" href="#__codelineno-12-149"></a><span class="n">body_weight</span> <span class="o">=</span> <span class="mi">82</span>  <span class="c1"># kg</span>
</span><span id="__span-12-150"><a id="__codelineno-12-150" name="__codelineno-12-150" href="#__codelineno-12-150"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">body_weight</span> <span class="o">=</span> <span class="n">body_weight</span>
</span><span id="__span-12-151"><a id="__codelineno-12-151" name="__codelineno-12-151" href="#__codelineno-12-151"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">min_time_in_state</span> <span class="o">=</span> <span class="mf">0.20</span>
</span><span id="__span-12-152"><a id="__codelineno-12-152" name="__codelineno-12-152" href="#__codelineno-12-152"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">loadLStance</span> <span class="o">=</span> <span class="o">-</span><span class="n">body_weight</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-12-153"><a id="__codelineno-12-153" name="__codelineno-12-153" href="#__codelineno-12-153"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">ankleThetaEstanceToLstance</span> <span class="o">=</span> <span class="mf">6.0</span>
</span><span id="__span-12-154"><a id="__codelineno-12-154" name="__codelineno-12-154" href="#__codelineno-12-154"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">loadESwing</span> <span class="o">=</span> <span class="o">-</span><span class="n">body_weight</span> <span class="o">*</span> <span class="mf">0.15</span>
</span><span id="__span-12-155"><a id="__codelineno-12-155" name="__codelineno-12-155" href="#__codelineno-12-155"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">kneeThetaESwingToLSwing</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="__span-12-156"><a id="__codelineno-12-156" name="__codelineno-12-156" href="#__codelineno-12-156"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">kneeDthetaESwingToLSwing</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-12-157"><a id="__codelineno-12-157" name="__codelineno-12-157" href="#__codelineno-12-157"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">loadEStance</span> <span class="o">=</span> <span class="o">-</span><span class="n">body_weight</span> <span class="o">*</span> <span class="mf">0.4</span>
</span><span id="__span-12-158"><a id="__codelineno-12-158" name="__codelineno-12-158" href="#__codelineno-12-158"></a><span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">transition_parameters</span><span class="o">.</span><span class="n">kneeThetaLSwingToEStance</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="__span-12-159"><a id="__codelineno-12-159" name="__codelineno-12-159" href="#__codelineno-12-159"></a>
</span><span id="__span-12-160"><a id="__codelineno-12-160" name="__codelineno-12-160" href="#__codelineno-12-160"></a><span class="k">with</span> <span class="n">knee</span><span class="p">,</span> <span class="n">ankle</span><span class="p">,</span> <span class="n">loadcell</span><span class="p">:</span>
</span><span id="__span-12-161"><a id="__codelineno-12-161" name="__codelineno-12-161" href="#__codelineno-12-161"></a>    <span class="n">knee</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="__span-12-162"><a id="__codelineno-12-162" name="__codelineno-12-162" href="#__codelineno-12-162"></a>    <span class="n">ankle</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
</span><span id="__span-12-163"><a id="__codelineno-12-163" name="__codelineno-12-163" href="#__codelineno-12-163"></a>
</span><span id="__span-12-164"><a id="__codelineno-12-164" name="__codelineno-12-164" href="#__codelineno-12-164"></a>    <span class="n">knee</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">knee</span><span class="o">.</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-12-165"><a id="__codelineno-12-165" name="__codelineno-12-165" href="#__codelineno-12-165"></a>    <span class="n">ankle</span><span class="o">.</span><span class="n">set_control_mode</span><span class="p">(</span><span class="n">ankle</span><span class="o">.</span><span class="n">CONTROL_MODES</span><span class="o">.</span><span class="n">IMPEDANCE</span><span class="p">)</span>
</span><span id="__span-12-166"><a id="__codelineno-12-166" name="__codelineno-12-166" href="#__codelineno-12-166"></a>
</span><span id="__span-12-167"><a id="__codelineno-12-167" name="__codelineno-12-167" href="#__codelineno-12-167"></a>    <span class="n">knee</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-12-168"><a id="__codelineno-12-168" name="__codelineno-12-168" href="#__codelineno-12-168"></a>    <span class="n">ankle</span><span class="o">.</span><span class="n">set_impedance_cc_pidf_gains</span><span class="p">()</span>
</span><span id="__span-12-169"><a id="__codelineno-12-169" name="__codelineno-12-169" href="#__codelineno-12-169"></a>    <span class="c1"># Main Loop</span>
</span><span id="__span-12-170"><a id="__codelineno-12-170" name="__codelineno-12-170" href="#__codelineno-12-170"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">clock</span><span class="p">:</span>
</span><span id="__span-12-171"><a id="__codelineno-12-171" name="__codelineno-12-171" href="#__codelineno-12-171"></a>        <span class="n">knee</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-12-172"><a id="__codelineno-12-172" name="__codelineno-12-172" href="#__codelineno-12-172"></a>        <span class="n">ankle</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-12-173"><a id="__codelineno-12-173" name="__codelineno-12-173" href="#__codelineno-12-173"></a>        <span class="n">loadcell</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="__span-12-174"><a id="__codelineno-12-174" name="__codelineno-12-174" href="#__codelineno-12-174"></a>
</span><span id="__span-12-175"><a id="__codelineno-12-175" name="__codelineno-12-175" href="#__codelineno-12-175"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">knee_angle</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span><span class="n">knee</span><span class="o">.</span><span class="n">output_position</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
</span><span id="__span-12-176"><a id="__codelineno-12-176" name="__codelineno-12-176" href="#__codelineno-12-176"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">ankle_angle</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span><span class="n">ankle</span><span class="o">.</span><span class="n">output_position</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
</span><span id="__span-12-177"><a id="__codelineno-12-177" name="__codelineno-12-177" href="#__codelineno-12-177"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">knee_velocity</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span>
</span><span id="__span-12-178"><a id="__codelineno-12-178" name="__codelineno-12-178" href="#__codelineno-12-178"></a>            <span class="n">knee</span><span class="o">.</span><span class="n">output_velocity</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Velocity</span><span class="o">.</span><span class="n">deg_per_s</span>
</span><span id="__span-12-179"><a id="__codelineno-12-179" name="__codelineno-12-179" href="#__codelineno-12-179"></a>        <span class="p">)</span>
</span><span id="__span-12-180"><a id="__codelineno-12-180" name="__codelineno-12-180" href="#__codelineno-12-180"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">ankle_velocity</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">convert_from_default</span><span class="p">(</span>
</span><span id="__span-12-181"><a id="__codelineno-12-181" name="__codelineno-12-181" href="#__codelineno-12-181"></a>            <span class="n">ankle</span><span class="o">.</span><span class="n">output_velocity</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Velocity</span><span class="o">.</span><span class="n">deg_per_s</span>
</span><span id="__span-12-182"><a id="__codelineno-12-182" name="__codelineno-12-182" href="#__codelineno-12-182"></a>        <span class="p">)</span>
</span><span id="__span-12-183"><a id="__codelineno-12-183" name="__codelineno-12-183" href="#__codelineno-12-183"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">Fz</span> <span class="o">=</span> <span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span>
</span><span id="__span-12-184"><a id="__codelineno-12-184" name="__codelineno-12-184" href="#__codelineno-12-184"></a>
</span><span id="__span-12-185"><a id="__codelineno-12-185" name="__codelineno-12-185" href="#__codelineno-12-185"></a>        <span class="c1"># Update any control inputs that change every loop</span>
</span><span id="__span-12-186"><a id="__codelineno-12-186" name="__codelineno-12-186" href="#__codelineno-12-186"></a>        <span class="n">controller</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">t</span>
</span><span id="__span-12-187"><a id="__codelineno-12-187" name="__codelineno-12-187" href="#__codelineno-12-187"></a>
</span><span id="__span-12-188"><a id="__codelineno-12-188" name="__codelineno-12-188" href="#__codelineno-12-188"></a>        <span class="c1"># Call the controller</span>
</span><span id="__span-12-189"><a id="__codelineno-12-189" name="__codelineno-12-189" href="#__codelineno-12-189"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-12-190"><a id="__codelineno-12-190" name="__codelineno-12-190" href="#__codelineno-12-190"></a>
</span><span id="__span-12-191"><a id="__codelineno-12-191" name="__codelineno-12-191" href="#__codelineno-12-191"></a>        <span class="c1"># Test print to ensure external library call works</span>
</span><span id="__span-12-192"><a id="__codelineno-12-192" name="__codelineno-12-192" href="#__codelineno-12-192"></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-12-193"><a id="__codelineno-12-193" name="__codelineno-12-193" href="#__codelineno-12-193"></a>            <span class="sa">f</span><span class="s2">&quot;Current time in state </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">current_state</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">time_in_current_state</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds, </span><span class="se">\</span>
</span><span id="__span-12-194"><a id="__codelineno-12-194" name="__codelineno-12-194" href="#__codelineno-12-194"></a><span class="s2">                Knee Eq </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
</span><span id="__span-12-195"><a id="__codelineno-12-195" name="__codelineno-12-195" href="#__codelineno-12-195"></a><span class="s2">                Ankle Eq </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="se">\</span>
</span><span id="__span-12-196"><a id="__codelineno-12-196" name="__codelineno-12-196" href="#__codelineno-12-196"></a><span class="s2">                Fz </span><span class="si">{</span><span class="n">loadcell</span><span class="o">.</span><span class="n">fz</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-12-197"><a id="__codelineno-12-197" name="__codelineno-12-197" href="#__codelineno-12-197"></a>            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-12-198"><a id="__codelineno-12-198" name="__codelineno-12-198" href="#__codelineno-12-198"></a>        <span class="p">)</span>
</span><span id="__span-12-199"><a id="__codelineno-12-199" name="__codelineno-12-199" href="#__codelineno-12-199"></a>
</span><span id="__span-12-200"><a id="__codelineno-12-200" name="__codelineno-12-200" href="#__codelineno-12-200"></a>        <span class="c1"># Write to the hardware</span>
</span><span id="__span-12-201"><a id="__codelineno-12-201" name="__codelineno-12-201" href="#__codelineno-12-201"></a>        <span class="n">knee</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">(</span>
</span><span id="__span-12-202"><a id="__codelineno-12-202" name="__codelineno-12-202" href="#__codelineno-12-202"></a>            <span class="n">k</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Stiffness</span><span class="o">.</span><span class="n">N_m_per_rad</span><span class="p">),</span>
</span><span id="__span-12-203"><a id="__codelineno-12-203" name="__codelineno-12-203" href="#__codelineno-12-203"></a>            <span class="n">b</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Damping</span><span class="o">.</span><span class="n">N_m_per_rad_per_s</span><span class="p">),</span>
</span><span id="__span-12-204"><a id="__codelineno-12-204" name="__codelineno-12-204" href="#__codelineno-12-204"></a>        <span class="p">)</span>
</span><span id="__span-12-205"><a id="__codelineno-12-205" name="__codelineno-12-205" href="#__codelineno-12-205"></a>        <span class="n">knee</span><span class="o">.</span><span class="n">set_output_position</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">knee_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
</span><span id="__span-12-206"><a id="__codelineno-12-206" name="__codelineno-12-206" href="#__codelineno-12-206"></a>        <span class="n">ankle</span><span class="o">.</span><span class="n">set_output_impedance</span><span class="p">(</span>
</span><span id="__span-12-207"><a id="__codelineno-12-207" name="__codelineno-12-207" href="#__codelineno-12-207"></a>            <span class="n">k</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">stiffness</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Stiffness</span><span class="o">.</span><span class="n">N_m_per_rad</span><span class="p">),</span>
</span><span id="__span-12-208"><a id="__codelineno-12-208" name="__codelineno-12-208" href="#__codelineno-12-208"></a>            <span class="n">b</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">damping</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Damping</span><span class="o">.</span><span class="n">N_m_per_rad_per_s</span><span class="p">),</span>
</span><span id="__span-12-209"><a id="__codelineno-12-209" name="__codelineno-12-209" href="#__codelineno-12-209"></a>        <span class="p">)</span>
</span><span id="__span-12-210"><a id="__codelineno-12-210" name="__codelineno-12-210" href="#__codelineno-12-210"></a>        <span class="n">ankle</span><span class="o">.</span><span class="n">set_output_position</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">convert_to_default</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">ankle_impedance</span><span class="o">.</span><span class="n">eq_angle</span><span class="p">,</span> <span class="n">units</span><span class="o">.</span><span class="n">Position</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
</span><span id="__span-12-211"><a id="__codelineno-12-211" name="__codelineno-12-211" href="#__codelineno-12-211"></a>
</span><span id="__span-12-212"><a id="__codelineno-12-212" name="__codelineno-12-212" href="#__codelineno-12-212"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://www.opensourceleg.org/">The Open-Source Leg Team</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/neurobionics/opensourceleg" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/opensourceleg" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>